<html>
<head>
    <title>JFox 安装手册 </title>
</head>
<body>
<h1>JFox 安装手册</h1>

<p style="text-align: left;" align="left"><b><span style="font-size: 24pt;" lang="EN-US">1.</span></b><b><span style="font-size: 24pt;">介绍</span></b><span style="font-size: 12pt;" lang="EN-US"></span></p>

<p style="text-align: left;" align="left"><span style="font-size: 12pt;">本指南介绍如何基于<span lang="EN-US">Tomcat</span>安装<span lang="EN-US">JFox3 Application Server</span>。<span lang="EN-US"></span></span></p>

<p style="text-align: left;" align="left"><span style="font-size: 12pt;" lang="EN-US">&nbsp;</span></p>

<p style="text-align: left;" align="left"><b><span style="font-size: 24pt;" lang="EN-US">2.</span></b><b><span style="font-size: 24pt;">资源下载</span></b><span style="font-size: 12pt;" lang="EN-US"></span></p>

<ul>
<li style="text-align: left;"><span style="font-size: 12pt;">下载<span lang="EN-US">Tomcat <a href="http://tomcat.apache.org/">http://tomcat.apache.org</a></span></span></li>

<li style="text-align: left;"><span style="font-size: 12pt;">下载<span lang="EN-US">JFox3 <a href="http://code.google.com/p/jfox">http://code.google.com/p/jfox</a></span></span></li>
</ul>

<p style="text-align: left;" align="left"><b><span style="font-size: 24pt;" lang="EN-US">3.</span></b><b><span style="font-size: 24pt;">安装<span lang="EN-US">JFox</span></span></b><span style="font-size: 12pt;" lang="EN-US"></span></p>

<p style="text-align: left;" align="left"><b><span style="font-size: 18pt;" lang="EN-US">&nbsp;</span></b><span style="font-size: 12pt;" lang="EN-US"></span></p>

<p style="text-align: left;" align="left"><b><span style="font-size: 18pt;" lang="EN-US">3.1</span></b><b><span style="font-size: 18pt;">安装<span lang="EN-US">Tomcat</span></span></b><span style="font-size: 12pt;" lang="EN-US"></span></p>

<p style="text-align: left;" align="left"><span style="font-size: 12pt;">详细过程请参考<span lang="EN-US"> Tomat </span>安装手册<span lang="EN-US">... </span></span></p>

<p style="text-align: left;" align="left"><b><span style="font-size: 18pt;" lang="EN-US">&nbsp;</span></b><span style="font-size: 12pt;" lang="EN-US"></span></p>

<p style="text-align: left;" align="left"><b><span style="font-size: 18pt;" lang="EN-US">3.2</span></b><b><span style="font-size: 18pt;">部署<span lang="EN-US">JFox</span></span></b><span style="font-size: 12pt;" lang="EN-US"></span></p>

<p style="text-align: left;" align="left"><span style="font-size: 12pt;">将 下载的<span lang="EN-US"> jfox3.war </span>拷贝到<span lang="EN-US"> %TOMCAT_HOME%/webapps </span>下，启动<span lang="EN-US">Tomcat</span>，<span lang="EN-US">jfox3</span>即作为一个<span lang="EN-US">Web
application</span>部署在<span lang="EN-US">Tomcat</span>中，<span lang="EN-US">jfox3</span>部署之后，是一个标准的<span lang="EN-US"> Web application </span>的目录结构，该<span lang="EN-US">Web application</span>将具备<span lang="EN-US">jfox3</span>所提供的一切功能，<span lang="EN-US">EJB3 Container</span>、<span lang="EN-US">JPA</span>、<span lang="EN-US">JFox MVC</span>等。 <span lang="EN-US"></span></span></p>

<p style="text-align: left;" align="left"><b><span style="font-size: 13.5pt;" lang="EN-US">&nbsp;</span></b><span style="font-size: 12pt;" lang="EN-US"></span></p>

<p style="text-align: left;" align="left"><b><span style="font-size: 13.5pt;" lang="EN-US">3.2.1</span></b><b><span style="font-size: 13.5pt;" lang="EN-US">JFox3</span></b><b><span style="font-size: 13.5pt;">的<span lang="EN-US">WEB-INF</span></span></b><span style="font-size: 12pt;" lang="EN-US"></span></p>

<p style="text-align: left;" align="left"><span style="font-size: 12pt;" lang="EN-US">JFox3 </span><span style="font-size: 12pt;">的<span lang="EN-US">WEB-INF</span>目录存放了除<span lang="EN-US">html</span>、<span lang="EN-US">image</span>、<span lang="EN-US">jsp</span>之外的所有资源，其中包括所有<span lang="EN-US">jfox3</span>需要的<span lang="EN-US">jar</span>、<span lang="EN-US">class</span>、配置文件，还有所有的应用
模块，<span lang="EN-US">jfox3/WEB-INF/MODULES</span>就是<span lang="EN-US">jfox3</span>的模块部署目录，所有的模块都以目录的形式发布在这里，默认有一个<span lang="EN-US">manager</span>模块。<span lang="EN-US"> manager</span>模块是<span lang="EN-US">jfox3</span>内置的一个模块，展示了各种<span lang="EN-US">jfox3</span>的<span lang="EN-US">example</span>程序，通过这个模块，我们也可以了解以下<span lang="EN-US">jfox3</span>模块的结构。<span lang="EN-US"> JFox3 Module</span>的结构在下面有专门讲述。 <span lang="EN-US"></span></span></p>

<p style="text-align: left;" align="left"><b><span style="font-size: 18pt;" lang="EN-US">&nbsp;</span></b><span style="font-size: 12pt;" lang="EN-US"></span></p>

<p style="text-align: left;" align="left"><b><span style="font-size: 18pt;" lang="EN-US">3.3</span></b><b><span style="font-size: 18pt;">配置</span></b><span style="font-size: 12pt;" lang="EN-US"></span></p>

<p style="text-align: left;" align="left"><span style="font-size: 12pt;" lang="EN-US">jfox3</span><span style="font-size: 12pt;">的配置非常简单，需要的配置的内容主要包括<span lang="EN-US">web.xml</span>以及<span lang="EN-US">persistence.xml</span>。 <span lang="EN-US"></span></span></p>

<p style="text-align: left;" align="left"><b><span style="font-size: 13.5pt;" lang="EN-US">&nbsp;</span></b><span style="font-size: 12pt;" lang="EN-US"></span></p>

<p style="text-align: left;" align="left"><b><span style="font-size: 13.5pt;" lang="EN-US">3.3.1</span></b><b><span style="font-size: 13.5pt;" lang="EN-US">jfox3/WEB-INF/web.xml</span></b><span style="font-size: 12pt;" lang="EN-US"></span></p>

<p style="text-align: left;" align="left"><span style="font-size: 12pt;" lang="EN-US">jfox3 web application </span><span style="font-size: 12pt;">的配置文件，有这些重要的内容。</span></p>

<p style="text-align: left;" align="left"><span style="font-size: 12pt;">&nbsp;<span lang="EN-US"></span></span></p>

<p style="text-align: left;" align="left"><span style="font-size: 12pt;">这里配置了<span lang="EN-US">JFox</span>启动时需要的加载的模块列表，如果你开发了新的模块，请在这里添加。 <span lang="EN-US"></span></span></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&lt;context-param&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;&nbsp;&nbsp; &lt;param-name&gt;MODULES&lt;/param-name&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;&nbsp;&nbsp;
&lt;param-value&gt;/WEB-INF/MODULES/manager,/WEB-INF/MODULES/petstore&lt;/param-value&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&lt;/context-param&gt;</span></font></p>

<p style="text-align: left;" align="left"><span style="font-size: 12pt;" lang="EN-US">&nbsp;</span></p>

<p style="text-align: left;" align="left"><span style="font-size: 12pt;" lang="EN-US"></span></p>

<p style="text-align: left;" align="left"><span style="font-size: 12pt;">这里配置模块中模板文件所在的目录，如下的配置表明每个模块的<span lang="EN-US"> views</span>目录为模板文件所在的目录。 <span lang="EN-US"></span></span></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&lt;context-param&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;&nbsp;&nbsp; &lt;param-name&gt;VIEW_DIR&lt;/param-name&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;&nbsp;&nbsp; &lt;param-value&gt;views&lt;/param-value&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&lt;/context-param&gt;</span></font></p>

<p style="text-align: left;" align="left"><span style="font-size: 12pt;" lang="EN-US">&nbsp;</span></p>

<p style="text-align: left;" align="left"><span style="font-size: 12pt;" lang="EN-US"></span></p>

<p style="text-align: left;" align="left"><span style="font-size: 12pt;">这里配置<span lang="EN-US">Servlet Action</span>的访问时，<span lang="EN-US">url</span>后缀。 <span lang="EN-US"></span></span></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&lt;context-param&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;&nbsp;&nbsp; &lt;param-name&gt;ACTION_SUFFIX&lt;/param-name&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;&nbsp;&nbsp; &lt;param-value&gt;.do&lt;/param-value&gt;</span></font></p>

<p style="text-align: left;" align="left"><span style="font-size: 12pt;" lang="EN-US"><font color="#330099">&lt;/context-param&gt;</font></span></p>

<p style="text-align: left;" align="left"><span style="font-size: 12pt;" lang="EN-US"><font color="#330099">&nbsp;</font></span></p>

<p style="text-align: left;" align="left"><span style="font-size: 12pt;">这里配置了<span lang="EN-US">JFox3</span>的<span lang="EN-US">controller servlet</span>，并用来响应所有<span lang="EN-US">/modules/*</span>开头的<span lang="EN-US">url</span>，<span lang="EN-US">controller
servlet</span>会负责根据<span lang="EN-US">url</span>而把请求分发到正确的模块中，如：<span lang="EN-US">/modules/petstore/index.jsp</span>，访问的是<span lang="EN-US"> petstore </span>模块中的<span lang="EN-US"> index.jsp </span></span></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&lt;servlet&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;
&nbsp;&nbsp;&lt;servlet-name&gt;controller_servlet&lt;/servlet-name&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;&nbsp;&nbsp;
&lt;servlet-class&gt;net.sourceforge.jfox.mvc.servlet.ControllerServlet&lt;/servlet-class&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;&nbsp;&nbsp; &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&lt;/servlet&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&lt;servlet-mapping&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;&nbsp;&nbsp;
&lt;servlet-name&gt;controller_servlet&lt;/servlet-name&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;&nbsp;&nbsp; &lt;url-pattern&gt;/modules/*&lt;/url-pattern&gt;</span></font></p>

<p style="text-align: left;" align="left"><span style="font-size: 12pt;" lang="EN-US"><font color="#330099">&lt;/servlet-mapping&gt;</font></span></p>

<p style="text-align: left;" align="left"><span style="font-size: 12pt;" lang="EN-US"><font color="#330099">&nbsp;</font></span></p>

<p style="text-align: left;" align="left"><span style="font-size: 12pt;">这里配置<span lang="EN-US">JFox3</span>的<span lang="EN-US">TemplateServlet<a href="http://code.google.com/p/jfox/w/edit/TemplateServlet">?</a></span>，并为<span lang="EN-US">TemplateServlet<a href="http://code.google.com/p/jfox/w/edit/TemplateServlet">?</a></span>配置了<span lang="EN-US">VelocityRender<a href="http://code.google.com/p/jfox/w/edit/VelocityRender">?</a></span>，同时指出<span lang="EN-US">*.vm,*.tmpl,*.vhtm,*.vhtml</span>后缀的文件由<span lang="EN-US">VelocityRender<a href="http://code.google.com/p/jfox/w/edit/VelocityRender">?</a></span>负责渲染成<span lang="EN-US">html</span>页面；<span lang="EN-US">servlet-mapping</span>配置说明所有<span lang="EN-US">url</span>后缀<span lang="EN-US">*.tmpl,*.vhtml</span>的请求会由<span lang="EN-US">TemplateServlet<a href="http://code.google.com/p/jfox/w/edit/TemplateServlet">?</a></span>负责响应，<span lang="EN-US">TempletServlet<a href="http://code.google.com/p/jfox/w/edit/TempletServlet">?</a></span>会根据<span lang="EN-US">init-param</span>的配置再分发给不同的<span lang="EN-US">Render</span>来处理。 <span lang="EN-US"></span></span></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&lt;servlet&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;&nbsp;&nbsp;
&lt;servlet-name&gt;template_servlet&lt;/servlet-name&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;&nbsp;&nbsp;
&lt;servlet-class&gt;net.sourceforge.jfox.mvc.servlet.TemplateServlet&lt;/servlet-class&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;&nbsp;&nbsp; &lt;init-param&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;description&gt;velocity
render&lt;/description&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;param-name&gt;net.sourceforge.jfox.mvc.velocity.VelocityRender&lt;/param-name&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;param-value&gt;*.vm,*.tmpl,*.vhtm,*.vhtml&lt;/param-value&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;&nbsp;&nbsp; &lt;/init-param&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;&nbsp;&nbsp; &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&lt;/servlet&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&lt;servlet-mapping&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;&nbsp;&nbsp; &lt;servlet-name&gt;template_servlet&lt;/servlet-name&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;&nbsp;&nbsp; &lt;url-pattern&gt;*.tmpl&lt;/url-pattern&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&lt;/servlet-mapping&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&lt;servlet-mapping&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;&nbsp;&nbsp;
&lt;servlet-name&gt;template_servlet&lt;/servlet-name&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;&nbsp;&nbsp; &lt;url-pattern&gt;*.vhtml&lt;/url-pattern&gt;</span></font></p>

<p style="text-align: left;" align="left"><span style="font-size: 12pt;" lang="EN-US"><font color="#330099">&lt;/servlet-mapping&gt;</font></span></p>

<p style="text-align: left;" align="left"><span style="font-size: 12pt;" lang="EN-US">.</span></p>

<p style="text-align: left;" align="left"><span style="font-size: 12pt;" lang="EN-US">.</span></p>

<p style="text-align: left;" align="left"><span style="font-size: 12pt;" lang="EN-US">.</span></p>

<p style="text-align: left;" align="left"><b><span style="font-size: 13.5pt;" lang="EN-US">&nbsp;</span></b><span style="font-size: 12pt;" lang="EN-US"></span></p>

<p style="text-align: left;" align="left"><b><span style="font-size: 13.5pt;" lang="EN-US">3.3.2</span></b><b><span style="font-size: 13.5pt;" lang="EN-US">jfox3/WEB-INF/classes/META-INF/persistence.xml</span></b><span style="font-size: 12pt;" lang="EN-US"></span></p>

<p style="text-align: left;" align="left"><span style="font-size: 12pt;" lang="EN-US">persistence.xml</span><span style="font-size: 12pt;">用来配置<span lang="EN-US"> jfox3 </span>的数据源，配置文件格式如下：
<span lang="EN-US"></span></span></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;&nbsp;&nbsp; &lt;persistence-unit name="default"&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;jta-data-source&gt;java:/DefaultMySqlDS&lt;/jta-data-source&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;properties&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;property name="driver" value="com.mysql.jdbc.Driver"/&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;property name="url"
value="jdbc:mysql://localhost:3306/test"/&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;property name="username" value="root"/&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;property name="password" value="root"/&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;property name="minSize" value="5"/&gt; &lt;!-- min pool
size --&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;property name="maxSize" value="200"/&gt; &lt;!-- max
pool size --&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;property name="lifeTime" value="1800000"/&gt; &lt;!--
2h, connection max idle time --&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;property name="sleepTime" value="600000"/&gt; &lt;!--
PoolKeeper sleep time --&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;property name="deadLockRetryWait" value="2000"/&gt;
&lt;!-- retry time if no free connection --&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;property name="deadLockMaxWait" value="60000"/&gt;
&lt;!-- max wait time if no free connection --&gt;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/properties&gt;</span></font></p>

<p style="text-align: left;" align="left"><span style="font-size: 12pt;" lang="EN-US"><font color="#330099">&nbsp;&nbsp;&nbsp; &lt;/persistence-unit&gt;</font></span></p>

<p style="text-align: left;" align="left"><span style="font-size: 12pt;" lang="EN-US">&lt;persistence-unit name="default"&gt;</span><span style="font-size: 12pt;">说明在<span lang="EN-US">EJB3</span>中，可以使用<span lang="EN-US">@PersistenceContext<a href="http://code.google.com/p/jfox/w/edit/PersistenceContext">?</a>(unitName="default")</span>来注入<span lang="EN-US"> EntityManager<a href="http://code.google.com/p/jfox/w/edit/EntityManager">?</a></span>，<span lang="EN-US">&lt;jta-data-source&gt;java:/DefaultMySqlDS&lt;/jta-data-source&gt; </span>指明了该<span lang="EN-US">DataSource<a href="http://code.google.com/p/jfox/w/edit/DataSource">?</a></span>的<span lang="EN-US">JNDI</span>名称。 <span lang="EN-US"></span></span></p>

<p style="text-align: left;" align="left"><b><span style="font-size: 24pt;" lang="EN-US">&nbsp;</span></b><span style="font-size: 12pt;" lang="EN-US"></span></p>

<p style="text-align: left;" align="left"><b><span style="font-size: 24pt;" lang="EN-US">4.JFox3 Module</span></b><b><span style="font-size: 24pt;">介绍</span></b><span style="font-size: 12pt;" lang="EN-US"></span></p>

<p style="text-align: left;" align="left"><span style="font-size: 12pt;">基于<span lang="EN-US">JFox3</span>开发的应用以模块<span lang="EN-US">(Module)</span>的形式来发布，采用<span lang="EN-US">JFox3</span>进行开发可以充分享受模块化开发和部署的好处。<span lang="EN-US">Module</span>有自己结构和访问方式。
部署时，每个<span lang="EN-US">Module</span>拥有自己独立的<span lang="EN-US">ClassLoader<a href="http://code.google.com/p/jfox/w/edit/ClassLoader">?</a></span>。 <span lang="EN-US"></span></span></p>

<p style="text-align: left;" align="left"><b><span style="font-size: 18pt;" lang="EN-US">&nbsp;</span></b><span style="font-size: 12pt;" lang="EN-US"></span></p>

<p style="text-align: left;" align="left"><b><span style="font-size: 18pt;" lang="EN-US">4.1</span></b><b><span style="font-size: 18pt;">模块的目录结构</span></b><span style="font-size: 12pt;" lang="EN-US"></span></p>

<p style="text-align: left;" align="left"><span style="font-size: 12pt;" lang="EN-US">Module</span><span style="font-size: 12pt;">的目录主要有这几部分组成：类路径，<span lang="EN-US">View</span>模板路径，配置文件，以及其它目录和文件。
<span lang="EN-US"></span></span></p>

<p style="text-align: left;" align="left"><b><span style="font-size: 13.5pt;" lang="EN-US">&nbsp;</span></b><span style="font-size: 12pt;" lang="EN-US"></span></p>

<p style="text-align: left;" align="left"><b><span style="font-size: 13.5pt;" lang="EN-US">4.1.1</span></b><b><span style="font-size: 13.5pt;">类路径</span></b><span style="font-size: 12pt;" lang="EN-US"></span></p>

<p style="text-align: left;" align="left"><span style="font-size: 12pt;">位于类路径的<span lang="EN-US">jar</span>和<span lang="EN-US">class</span>文件将能够被<span lang="EN-US">Module</span>的<span lang="EN-US">ClassLoader<a href="http://code.google.com/p/jfox/w/edit/ClassLoader">?</a></span>搜索到，包括<span lang="EN-US">lib</span>、<span lang="EN-US">WEB-INF/lib</span>下所有的<span lang="EN-US">jar
</span>和<span lang="EN-US">zip</span>文件<span lang="EN-US">(</span>含子目录<span lang="EN-US">)</span>，以及<span lang="EN-US">classes</span>、<span lang="EN-US">WEB-INF/classes</span>下的<span lang="EN-US">class</span>，还有<span lang="EN-US">conf</span>下的文件。 <span lang="EN-US"></span></span></p>

<p style="text-align: left;" align="left"><b><span style="font-size: 13.5pt;" lang="EN-US">&nbsp;</span></b><span style="font-size: 12pt;" lang="EN-US"></span></p>

<p style="text-align: left;" align="left"><b><span style="font-size: 13.5pt;" lang="EN-US">4.1.2</span></b><b><span style="font-size: 13.5pt;" lang="EN-US">View</span></b><b><span style="font-size: 13.5pt;">模板路径</span></b><span style="font-size: 12pt;" lang="EN-US"></span></p>

<p style="text-align: left;" align="left"><span style="font-size: 12pt;">模板的默认目录名为<span lang="EN-US"> views</span>，这里可以存放在<span lang="EN-US">jsp</span>、<span lang="EN-US">image</span>、以及所有用于显示的模板文件，<span lang="EN-US">jfox3 MVC</span>默认配置了<span lang="EN-US">velocity</span>作为模板引擎，<span lang="EN-US">web.xml</span>中，配置了<span lang="EN-US">*.vm, *.vhtml, *.vhtm, *.tmpl</span>后缀将使用<span lang="EN-US">velocity</span>引擎来解析。 <span lang="EN-US"></span></span></p>

<p style="text-align: left;" align="left"><b><span style="font-size: 18pt;" lang="EN-US">&nbsp;</span></b><span style="font-size: 12pt;" lang="EN-US"></span></p>

<p style="text-align: left;" align="left"><b><span style="font-size: 18pt;" lang="EN-US">4.2</span></b><b><span style="font-size: 18pt;">如何通过浏览器访问模块</span></b><span style="font-size: 12pt;" lang="EN-US"></span></p>

<p style="text-align: left;" align="left"><span style="font-size: 12pt;">模块提供访问的内容主要有两部分，一是<span lang="EN-US">views</span>中的静态文件<span lang="EN-US">(html</span>，<span lang="EN-US">jsp)</span>等，二是模块中的<span lang="EN-US">Servlet Action</span>。 <span lang="EN-US"></span></span></p>

<p style="text-align: left;" align="left"><span style="font-size: 12pt;">比如<span lang="EN-US">manager</span>模块，访问静态文件的<span lang="EN-US"> url </span>为：<span lang="EN-US">/jfox3/modules/manager/index.html</span>，或者<span lang="EN-US">
/jfox3/modules/manager/index.jsp</span>； <span lang="EN-US"></span></span></p>

<p style="text-align: left;" align="left"><span style="font-size: 12pt;">访问<span lang="EN-US">Action</span>的<span lang="EN-US">url</span>为：<span lang="EN-US">/jfox3/modules/manager/example.view.do</span>，<span lang="EN-US">example</span>是<span lang="EN-US"> Action</span>部署的<span lang="EN-US">id</span>，<span lang="EN-US">view</span>是<span lang="EN-US">Action</span>中的<span lang="EN-US">ActionMethod<a href="http://code.google.com/p/jfox/w/edit/ActionMethod">?</a></span>，<span lang="EN-US">ActionMethod<a href="http://code.google.com/p/jfox/w/edit/ActionMethod">?</a></span>是用<span lang="EN-US">@ActionMethod<a href="http://code.google.com/p/jfox/w/edit/ActionMethod">?</a></span>描述的<span lang="EN-US">Action</span>类中的方法，该<span lang="EN-US">Action</span>应该类似如下的代码： <span lang="EN-US"></span></span></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">@Service(id = "example")</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">public class ExampleAction extends ActionSupport {</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;&nbsp;&nbsp; @ActionMethod(successView = "view.vhtml")</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;&nbsp;&nbsp; public void doGetView(InvocationContext
invocationContext) throws Exception {</span></font></p>

<p style="text-align: left;" align="left"><font color="#330099"><span style="font-size: 12pt;" lang="EN-US">&nbsp;&nbsp;&nbsp; }</span></font></p>

<p style="text-align: left;" align="left"><span style="font-size: 12pt;" lang="EN-US"><font color="#330099">}</font></span></p>

<p style="text-align: left;" align="left"><b><span style="font-size: 12pt;" lang="EN-US">NOTE:</span></b><span style="font-size: 12pt;" lang="EN-US"></span><span style="font-size: 12pt;">如果是通过<span lang="EN-US"> Http Get</span>访问<span lang="EN-US"> example.view.do</span>，会调用<span lang="EN-US"> doGetView </span>方法；如果通过<span lang="EN-US"> Http Post</span>访问<span lang="EN-US"> example.view.do</span>，会调用<span lang="EN-US"> doPostView </span>方法。 <span lang="EN-US"></span></span></p>

<p style="text-align: left;" align="left"><b><span style="font-size: 24pt;" lang="EN-US">&nbsp;</span></b><span style="font-size: 12pt;" lang="EN-US"></span></p>

<p style="text-align: left;" align="left"><b><span style="font-size: 24pt;" lang="EN-US">5.</span></b><b><span style="font-size: 24pt;">安装<span lang="EN-US">JFox petstore</span></span></b><span style="font-size: 12pt;" lang="EN-US"></span></p>

<p style="text-align: left;" align="left"><span style="font-size: 12pt;" lang="EN-US">JPetstore</span><span style="font-size: 12pt;">是一个在线宠物商店，用来演示<span lang="EN-US">J2EE Web</span>应用。<span lang="EN-US">JFox petstore</span>基于<span lang="EN-US">iBatis JPetstore</span>，采用<span lang="EN-US">JFox</span>的<span lang="EN-US">EJB3</span>、<span lang="EN-US">JPA</span>以及<span lang="EN-US">JFox MVC</span>进行了重写。<span lang="EN-US"></span></span></p>

<p style="text-align: left;" align="left"><span style="font-size: 12pt;">该安装指南介绍如何在<span lang="EN-US">JFox</span>正确的安装和配置<span lang="EN-US">JFox petstore</span>，如果你想了解<span lang="EN-US">JPetstore</span>的使用，请参考<span lang="EN-US">&nbsp;JPetstore help</span>。<span lang="EN-US"></span></span></p>

<p style="text-align: left;" align="left"><span style="font-size: 12pt;" lang="EN-US">&nbsp;</span></p>

<p style="text-align: left;" align="left"><span style="font-size: 12pt;">首先请确认已经正确的安装了<span lang="EN-US">JFox3</span>和<span lang="EN-US">MySQL(</span>建议<span lang="EN-US">5.0</span>以上版本<span lang="EN-US">)</span>，接下来<span lang="EN-US"></span></span></p>

<p style="margin-left: 36pt; text-align: left; text-indent: -36pt;" align="left"><span style="font-size: 12pt;" lang="EN-US"><span style="">1．<span style="font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span style="font-size: 12pt;">配置<span lang="EN-US">petstore</span>需要的数据源<span lang="EN-US"></span></span></p>

<p style="text-align: left; text-indent: 21pt;" align="left"><span style="font-size: 12pt;">打开<span lang="EN-US">%JFOX3_WEB_APP_HOME%/WEB-INF/classes/META-INFOpersistence.xml</span>，添加名称为的<span lang="EN-US">JPetstoreMysqlDS </span>的<span lang="EN-US">persistence-unit:</span></span></p>

<p style="text-align: left; text-indent: 21pt;" align="left"><font color="#000099"><span style="font-size: 12pt;" lang="EN-US"><span style="">&nbsp;&nbsp;&nbsp;
</span>&lt;persistence-unit name="JPetstoreMysqlDS"&gt;</span></font></p>

<p style="text-align: left; text-indent: 21pt;" align="left"><font color="#000099"><span style="font-size: 12pt;" lang="EN-US"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>&lt;jta-data-source&gt;java:/JPetstoreMysqlDS&lt;/jta-data-source&gt;</span></font></p>

<p style="text-align: left; text-indent: 21pt;" align="left"><font color="#000099"><span style="font-size: 12pt;" lang="EN-US"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>&lt;properties&gt;</span></font></p>

<p style="text-align: left; text-indent: 21pt;" align="left"><font color="#000099"><span style="font-size: 12pt;" lang="EN-US"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>&lt;property name="driver"
value="com.mysql.jdbc.Driver"/&gt;</span></font></p>

<p style="text-align: left; text-indent: 21pt;" align="left"><font color="#000099"><span style="font-size: 12pt;" lang="EN-US"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>&lt;property name="url"
value="jdbc:mysql://localhost:3306/jpetstore"/&gt;</span></font></p>

<p style="text-align: left; text-indent: 21pt;" align="left"><font color="#000099"><span style="font-size: 12pt;" lang="EN-US"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>&lt;property name="username" value="root"/&gt;</span></font></p>

<p style="text-align: left; text-indent: 21pt;" align="left"><font color="#000099"><span style="font-size: 12pt;" lang="EN-US"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>&lt;property name="password" value="root"/&gt;</span></font></p>

<p style="text-align: left; text-indent: 21pt;" align="left"><font color="#000099"><span style="font-size: 12pt;" lang="EN-US"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>&lt;property name="minSize" value="5"/&gt; &lt;!--
min pool size --&gt;</span></font></p>

<p style="text-align: left; text-indent: 21pt;" align="left"><font color="#000099"><span style="font-size: 12pt;" lang="EN-US"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>&lt;property name="maxSize" value="200"/&gt; &lt;!--
max pool size --&gt;</span></font></p>

<p style="text-align: left; text-indent: 21pt;" align="left"><font color="#000099"><span style="font-size: 12pt;" lang="EN-US"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>&lt;property name="lifeTime" value="1800000"/&gt;
&lt;!-- 2h, connection max idle time --&gt;</span></font></p>

<p style="text-align: left; text-indent: 21pt;" align="left"><font color="#000099"><span style="font-size: 12pt;" lang="EN-US"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>&lt;property name="sleepTime" value="600000"/&gt;
&lt;!-- PoolKeeper sleep time --&gt;</span></font></p>

<p style="text-align: left; text-indent: 21pt;" align="left"><font color="#000099"><span style="font-size: 12pt;" lang="EN-US"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>&lt;property name="deadLockRetryWait"
value="2000"/&gt; &lt;!-- retry time if no free connection --&gt;</span></font></p>

<p style="text-align: left; text-indent: 21pt;" align="left"><font color="#000099"><span style="font-size: 12pt;" lang="EN-US"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>&lt;property name="deadLockMaxWait"
value="60000"/&gt; <font size="2">&lt;!-- max wait time if no free connection --&gt;</font></span></font></p>

<p style="text-align: left; text-indent: 21pt;" align="left"><font color="#000099"><span style="font-size: 12pt;" lang="EN-US"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>&lt;/properties&gt;</span></font></p>

<p style="text-align: left; text-indent: 21pt;" align="left"><font color="#000099"><span style="font-size: 12pt;" lang="EN-US"><span style="">&nbsp;&nbsp;&nbsp;
</span>&lt;/persistence-unit&gt;</span></font></p>

<p style="margin-left: 21pt; text-align: left;" align="left"><span style="font-size: 12pt;" lang="EN-US">&nbsp;</span></p>

<p style="margin-left: 36pt; text-align: left; text-indent: -36pt;" align="left"><span style="font-size: 12pt;" lang="EN-US"><span style="">2．<span style="font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span style="font-size: 12pt;">安装<span lang="EN-US"> Petstore</span>模块<span lang="EN-US"></span></span></p>

<p style="margin-left: 21pt; text-align: left;" align="left"><span style="font-size: 12pt;">安装模块的过程很简单，将<span lang="EN-US">Petstore</span>解压到<span lang="EN-US">%JFOX3_WEB_APP_HOME%/WEB-INF/MODULES</span>模块下，目录名为<span lang="EN-US">petstore</span>，解压之后，还需要配置<span lang="EN-US">%JFOX3_WEB_APP_HOME%/WEB-INF/web.xml</span>，以便<span lang="EN-US">JFox3</span>启动时可以加载，如下：<span lang="EN-US"></span></span></p>

<p style="margin-left: 21pt; text-align: left;" align="left"><font color="#000099"><span style="font-size: 12pt;" lang="EN-US"><span style="">&nbsp;&nbsp;&nbsp;
</span>&lt;context-param&gt;</span></font></p>

<p style="margin-left: 21pt; text-align: left;" align="left"><font color="#000099"><span style="font-size: 12pt;" lang="EN-US"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>&lt;param-name&gt;MODULES&lt;/param-name&gt;</span></font></p>

<p style="margin-left: 21pt; text-align: left;" align="left"><font color="#000099"><span style="font-size: 12pt;" lang="EN-US"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>&lt;param-value&gt;/WEB-INF/MODULES/manager,/WEB-INF/MODULES/petstore&lt;/param-value&gt;</span></font></p>

<p style="margin-left: 21pt; text-align: left;" align="left"><font color="#000099"><span style="font-size: 12pt;" lang="EN-US"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>&lt;/context-param&gt;</span></font></p>

<p style="margin-left: 21pt; text-align: left;" align="left"><span style="font-size: 12pt;">多个模块目录使半角逗号<span lang="EN-US">(,)</span>分割。<span lang="EN-US"></span></span></p>

<p style="margin-left: 36pt; text-align: left; text-indent: -36pt;" align="left"><span style="font-size: 12pt;" lang="EN-US"><span style="">3．<span style="font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span style="font-size: 12pt;">导入初始化数据<span lang="EN-US"></span></span></p>

<p style="margin-left: 21pt; text-align: left;" align="left"><span style="font-size: 12pt;">注意：<span lang="EN-US">JFox Petstore</span>使用的数据库名为<span lang="EN-US">jpetstore</span>，请确认当前<span lang="EN-US">mysql</span>中没有该库，因为导入数据的时候会删除以存在的<span lang="EN-US">jpetstore</span>库而造成你的数据丢失。<span lang="EN-US"></span></span></p>

<p style="margin-left: 21pt; text-align: left;" align="left"><span style="font-size: 12pt;">用于初始化<span lang="EN-US">Petstore</span>的<span lang="EN-US">mysql</span>脚本位于<span lang="EN-US">%PETSTORE_MODULE_HOME%/db/mysql/</span></span><span lang="EN-US"></span><span style="font-size: 12pt;" lang="EN-US">jfox-petstore-backup.sql</span><span style="font-size: 12pt;">，使用你熟悉的命令行或者工具将其导入，建议你使用<span lang="EN-US">SQLyog(<a href="http://www.webyog.com/">http://www.webyog.com/</a>)</span>，非常不错的<span lang="EN-US">MySQL GUI Manager Tool</span>。<span lang="EN-US"></span></span></p>

<p style="margin-left: 36pt; text-align: left; text-indent: -36pt;" align="left"><span style="font-size: 12pt;" lang="EN-US"><span style="">4．<span style="font-style: normal; font-variant: normal; font-weight: normal; font-size: 7pt; line-height: normal; font-size-adjust: none; font-stretch: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span style="font-size: 12pt;">启动<span lang="EN-US">JFox3!</span></span></p>

<p style="margin-left: 15pt; text-align: left;" align="left"><span style="font-size: 12pt;">启动安装了<span lang="EN-US">JFox3</span>的<span lang="EN-US">Tomcat</span>，正常的话，可以看到类似如下的日志输出：<span lang="EN-US"></span></span></p>

<p style="margin-left: 15pt; text-align: left; text-indent: 6pt;" align="left"><span style="font-size: 12pt;" lang="EN-US">17:29:08,532 INFO<span style="">&nbsp;
</span>[Framework] Module: Petstore loaded, from D:\apache-tomcat-5.5.20\webapps\jfox3\WEB-INF\MODULES\petstore</span></p>
<span style="font-size: 12pt;">然后，访问
<span lang="EN-US"><a href="http://localhost:8080/jfox3/modules/petstore/welcome.html">http://localhost:8080/jfox3/modules/petstore/welcome.html</a></span>，即可以看到<span lang="EN-US">Petstore</span>的欢迎页面了，恭喜！</span>
<p><span style="" lang="EN-US">&nbsp;</span></p>


</body>
</html>
